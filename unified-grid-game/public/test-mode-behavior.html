<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Mode Behavior - Unified Grid Game</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .test-result { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .pass { background: #d4edda; color: #155724; }
        .fail { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        #results { margin-top: 20px; }
        .mode-toggle { background: #28a745; }
        .mode-toggle:hover { background: #1e7e34; }
    </style>
</head>
<body>
    <h1>Test Mode Behavior - Unified Grid Game</h1>
    <p>This page tests that human-human and human-AI modes behave identically for 1P experiments and differently for 2P experiments.</p>

    <div class="test-section">
        <h3>Mode Configuration</h3>
        <button class="mode-toggle" onclick="setMode('human-ai')">Set Human-AI Mode</button>
        <button class="mode-toggle" onclick="setMode('human-human')">Set Human-Human Mode</button>
        <div id="current-mode">Current Mode: <span id="mode-display">Loading...</span></div>
    </div>

    <div class="test-section">
        <h3>Experiment Tests</h3>
        <button onclick="test1PExperiment()">Test 1P1G Behavior</button>
        <button onclick="test2PExperiment()">Test 2P2G Behavior</button>
        <button onclick="runAllTests()">Run All Tests</button>
    </div>

    <div id="results"></div>

    <!-- Socket.io for real-time communication -->
    <script src="/socket.io/socket.io.js"></script>

    <!-- Core game scripts -->
    <script src="js/setup.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/mdp.js"></script>
    <script src="js/vizWithAI.js"></script>
    <script src="js/rlAgent.js"></script>

    <!-- Map data files -->
    <script src="designData/MapsFor1P1G.js"></script>
    <script src="designData/MapsFor1P2G.js"></script>
    <script src="designData/MapsFor2P2G.js"></script>
    <script src="designData/MapsFor2P3G.js"></script>

    <!-- Experiment configuration -->
    <script src="config/experimentConfig.js"></script>

    <!-- Unified NodeGame experiment system -->
    <script src="js/unifiedNodeGameExperiment.js"></script>

    <script>
        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = `${type === 'pass' ? '✅' : type === 'fail' ? '❌' : 'ℹ️'} ${message}`;
            results.appendChild(div);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        function updateModeDisplay() {
            const mode = window.EXPERIMENT_CONFIG?.experimentMode || 'unknown';
            document.getElementById('mode-display').textContent = mode;
        }

        function setMode(mode) {
            if (window.EXPERIMENT_CONFIG) {
                window.EXPERIMENT_CONFIG.experimentMode = mode;
                updateModeDisplay();
                addResult(`Mode changed to: ${mode}`, 'info');
            }
        }

        function test1PExperiment() {
            clearResults();
            addResult('=== Testing 1P1G Behavior ===', 'info');

            const mode = window.EXPERIMENT_CONFIG?.experimentMode || 'unknown';
            addResult(`Current mode: ${mode}`, 'info');

            // Test 1: Both modes should behave identically for 1P experiments
            if (typeof window.UnifiedNodeGameExperiment !== 'undefined') {
                // Simulate 1P experiment
                const gameData = window.UnifiedNodeGameExperiment.gameData;
                gameData.currentExperiment = '1P1G';

                // Test that both modes handle 1P experiments the same way
                const is1P = gameData.currentExperiment.includes('1P');
                addResult(`1P experiment detected: ${is1P}`, is1P ? 'pass' : 'fail');

                // Test that multiplayer UI is hidden for 1P experiments
                const shouldHideMultiplayer = is1P;
                addResult(`Multiplayer UI should be hidden for 1P: ${shouldHideMultiplayer}`, 'info');

                // Test that AI actions are not processed for 1P experiments
                const shouldNotProcessAI = is1P;
                addResult(`AI actions should not be processed for 1P: ${shouldNotProcessAI}`, 'info');

                // Test that trial completion is handled locally for 1P experiments
                const shouldCompleteLocally = is1P;
                addResult(`Trial completion should be local for 1P: ${shouldCompleteLocally}`, 'info');

            } else {
                addResult('UnifiedNodeGameExperiment not available', 'fail');
            }
        }

        function test2PExperiment() {
            clearResults();
            addResult('=== Testing 2P2G Behavior ===', 'info');

            const mode = window.EXPERIMENT_CONFIG?.experimentMode || 'unknown';
            addResult(`Current mode: ${mode}`, 'info');

            if (typeof window.UnifiedNodeGameExperiment !== 'undefined') {
                // Simulate 2P experiment
                const gameData = window.UnifiedNodeGameExperiment.gameData;
                gameData.currentExperiment = '2P2G';

                // Test that 2P experiments are detected
                const is2P = gameData.currentExperiment.includes('2P');
                addResult(`2P experiment detected: ${is2P}`, is2P ? 'pass' : 'fail');

                // Test mode-specific behavior for 2P experiments
                if (mode === 'human-human') {
                    addResult('Human-Human mode: Should use multiplayer for 2P', 'info');
                    addResult('Human-Human mode: Should send moves to server', 'info');
                    addResult('Human-Human mode: Should show multiplayer UI', 'info');
                } else if (mode === 'human-ai') {
                    addResult('Human-AI mode: Should use AI partner for 2P', 'info');
                    addResult('Human-AI mode: Should process AI actions', 'info');
                    addResult('Human-AI mode: Should complete trials locally', 'info');
                }

            } else {
                addResult('UnifiedNodeGameExperiment not available', 'fail');
            }
        }

        function runAllTests() {
            clearResults();
            addResult('=== Running All Mode Behavior Tests ===', 'info');

            // Test dependencies
            const dependencies = {
                'DIRECTIONS': typeof DIRECTIONS !== 'undefined',
                'OBJECT': typeof OBJECT !== 'undefined',
                'EXPSETTINGS': typeof window.EXPSETTINGS !== 'undefined',
                'MapsFor1P1G': typeof MapsFor1P1G !== 'undefined',
                'MapsFor2P2G': typeof MapsFor2P2G !== 'undefined',
                'UnifiedNodeGameExperiment': typeof window.UnifiedNodeGameExperiment !== 'undefined'
            };

            let allDepsGood = true;
            for (const [name, available] of Object.entries(dependencies)) {
                addResult(`${name}: ${available ? 'Available' : 'Missing'}`, available ? 'pass' : 'fail');
                if (!available) allDepsGood = false;
            }

            if (allDepsGood) {
                addResult('All dependencies loaded successfully', 'pass');

                // Test 1P behavior
                addResult('--- Testing 1P Behavior ---', 'info');
                const gameData = window.UnifiedNodeGameExperiment.gameData;
                gameData.currentExperiment = '1P1G';

                const is1P = gameData.currentExperiment.includes('1P');
                addResult(`1P experiment detection: ${is1P}`, is1P ? 'pass' : 'fail');

                // Test 2P behavior
                addResult('--- Testing 2P Behavior ---', 'info');
                gameData.currentExperiment = '2P2G';

                const is2P = gameData.currentExperiment.includes('2P');
                addResult(`2P experiment detection: ${is2P}`, is2P ? 'pass' : 'fail');

                // Test mode detection
                const currentMode = window.EXPERIMENT_CONFIG?.experimentMode || 'unknown';
                addResult(`Current experiment mode: ${currentMode}`, 'info');

            } else {
                addResult('Some dependencies missing - cannot run full tests', 'fail');
            }
        }

        // Auto-update mode display on page load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(updateModeDisplay, 1000);
        });
    </script>
</body>
</html>